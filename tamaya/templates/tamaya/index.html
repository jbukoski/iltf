{% extends 'base.html' %}

{% block side_bar %}

    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle btn" data-toggle="collapse" data-target=".navbar-collapse" style="height: 34px; padding: 5px 10px; margin-right: 10px;"><i class="fa fa-ellipsis-v" style="color: white"></i></button>
            <button id="toggle" type="button" class="navbar-toggle btn" style="height: 34px; padding: 5px 10px; margin-right: 10px;"><i id="toggleIcon" class="fa fa-check-square-o" style="color: white"></i></button>
            <a class="navbar-brand" href="http://www.tamaya-nsn.gov/index.html" target="_blank_">Pueblo of Santa Ana</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar-collapse">
            <ul class="nav navbar-nav pull-left">
                <a class="navbar-brand" href="#" style="font-size: 0.75m; color: gray;">Land & Natural Assets Map</a>
            </ul>
        </div>
    </div>

    <div class="row" id="container">
            <div class="col-sm-3 col-lg-3" id="sidebar" style="padding: 10px; overflow: auto;">
                <ul class="nav nav-tabs" id="myTab">
                    <li class="active"><a href="#layers" data-toggle="tab"><i class="fa fa-check-square-o"></i>&nbsp;Layers</a></li>
		    <li><a href="#legend" data-toggle="tab"><i class="fa fa-barcode"></i>&nbsp;Legends</a></li>
		    <li><a href="#download" data-toggle="tab"><i class="fa fa-download"></i>&nbsp;Data</a></li>
                </ul>

                <div class="tab-content" style="padding-top: 10px;">
                    <div class="tab-pane active" id="layers">
                        <div class="panel-group">

                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#admin-layers">
                                        Administrative Layers
                                    </a>
                                </div>
                                <div id="admin-layers" class="panel-collapse collapse in">
                                    <div class="panel-body" style="padding: 0px 15px;">
					<div class="checkbox">    
					    <label>
                                                <input type="checkbox" name="overlayLayers" id="boundary" z-index="1" checked>
                                                &nbsp Reservation boundary (approximate)			
                                            </label>
                                        </div>
					<div class="checkbox">    
					    <label>
                                                <input type="checkbox" name="overlayLayers" id="mbls" z-index="2" checked>
                                                &nbsp Master business leases					
                                            </label>
                                        </div>
					<div class="checkbox">    
					    <label>
                                                <input type="checkbox" name="overlayLayers" id="roads" z-index="3">
                                                &nbsp Reservation roads					
                                            </label>
                                        </div>
				    </div>
				</div>
                            </div> <!--Closes 'panel panel-default'-->

			    <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#soil-layers">
                                        Soil Layers
                                    </a>
                                </div>
                                <div id="soil-layers" class="panel-collapse collapse in">
                                    <div class="panel-body" style="padding: 0px 15px;">
					<div class="checkbox">    
					    <label>                                               
                                                <input type="checkbox" name="overlayLayers" id="bulkDens" z-index="3">
                                                &nbsp Soil bulk density				
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="soil_ph" z-index="3">
                                                &nbsp Soil surface pH, weighted average
                                            </label>
                                        </div>
				    </div>
				</div>
                            </div>  

			    <!--<div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#veg-layers">
                                        Vegetation Layers
                                    </a>
                                </div>
                                <div id="veg-layers" class="panel-collapse collapse in">
                                    <div class="panel-body" style="padding: 0px 15px;">
					<div class="checkbox">    
					    <label>
                                                <input type="checkbox" name="overlayLayers" id="landfire" z-index="99">
                                                &nbsp Existing vegetation type, LANDFIRE					
                                            </label>
                                        </div>
				    </div>
				</div>
                            </div> --> 
							
			    <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#imagery">
                                        Base Layers
                                    </a>
                                </div>
                                <div id="imagery" class="panel-collapse collapse in">
                                    <div class="panel-body" style="padding: 0px 15px;">
					<div class="radio">
					    <label>
                                                <input type="radio" name="basemapLayers" id="recent"checked>
                                                &nbsp Digital Globe imagery, no roads				
                                            </label>
                                        </div>
                                        <div class="radio">
					    <label>
                                                <input type="radio" name="basemapLayers" id="hybrid">
                                                &nbsp Digital Globe imagery, with roads				
                                            </label>
                                        </div>
					<div class="radio">    
					    <label>
                                                <input type="radio" name="basemapLayers" id="topo">
                                                &nbsp Topography, ESRI
                                            </label>
                                        </div>                                     
				    </div> 
			        </div>
			    </div> <!--Closes 'panel panel-default'-->
			 </br>

			</div>  <!--Closes 'panel group'-->
                    </div> <!--Closes id='layers'-->

		    <div class="tab-pane" id="legend">
		      <div class="panel-group">

			  <h4><strong>Vegetation:</strong></h4>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_" href="#landfire-labels">
                                        Existing Vegetation Type, LANDFIRE:
                                    </a>
                                </div>
                                <div id="landfire-labels" class="panel-collapse collapse in">
                                    <div class="panel-body" style="padding: 15px 15px;">
				      <div>
					<p>The legend items are arranged in order of existing vegetation type of greatest total coverage within the reservation to least total coverage. The hectares (ha) of coverage as well as the percent of the total reservation area covered are given for each vegetation type in the parentheses. Official documentation on LANDFIRE's Existing Vegetation Type (EVT) data can be found <a href=http://www.landfire.gov/NationalProductDescriptions21.php>here</a>.</p>
			</br>
					<div class="color-box" style="background-color:#FFE987"></div><div class="legLab">&nbsp Sandy Plains Semi-Desert Grassland (13,885.6 ha; 35.24%)</div>
					<div class="color-box" style="background-color:#826548"></div><div class="legLab">&nbsp Big Sagebrush Shrubland (13,820.5 ha; 35.07%)</div>
					<div class="color-box" style="background-color:#967B59"></div><div class="legLab">&nbsp Stabilized Coppice Dune and Sand Flat Scrub (6,310.7 ha; 16.01%)</div>
					<div class="color-box" style="background-color:#FFCC33"></div><div class="legLab">&nbsp Semi-Desert Shrubland (6,244.6 ha; 15.85%)</div>
					<div class="color-box" style="background-color:#4A2C1D"></div><div class="legLab">&nbsp Mixed Desert and Thornscrub (3,134.1 ha; 7.95%)</div>
					<div class="color-box" style="background-color:#79FF5E"></div><div class="legLab">&nbsp Pinyon-Juniper Woodland (1,816 ha; 4.61%)</div>
					<div class="color-box" style="background-color:#593B28"></div><div class="legLab">&nbsp Mogolland Chaparral (1,620.9 ha; 4.11%)</div>
					<div class="color-box" style="background-color:#0000FF"></div><div class="legLab">&nbsp Open Water (700.4 ha; 1.78%)</div>
					<div class="color-box" style="background-color:#9EAAD7"></div><div class="legLab">&nbsp Western Cool Temperate Developed Ruderal Shrubland (487.1 ha; 1.24%)</div>
					<div class="color-box" style="background-color:#AB916A"></div><div class="legLab">&nbsp Montane-Subalpine Grassland (404.8 ha; 1.03%)</div>
					<div class="color-box" style="background-color:#CA7AF5"></div><div class="legLab">&nbsp Western Cool Temperate Urban Herbaceous (355.2 ha; 0.90%)</div>
					<div class="color-box" style="background-color:#49ABBA"></div><div class="legLab">&nbsp Montane Riparian Forest and Woodland (306.0 ha; 0.78%)</div>
					<div class="color-box" style="background-color:#E3D41C"></div><div class="legLab">&nbsp Western Cool Temperate Pasture and Hayland (243.5 ha; 0.62%)</div>
					<div class="color-box" style="background-color:#FF8E42"></div><div class="legLab">&nbsp Shortgrass Prairie (239.3 ha; 0.61%)</div>
					<div class="color-box" style="background-color:#A18660"></div><div class="legLab">&nbsp Creosotebush Desert Scrub (238.4 ha; 0.60%)</div>
					<div class="color-box" style="background-color:#BFBFBF"></div><div class="legLab">&nbsp Barren (198.5 ha; 0.50%)</div>
					<div class="color-box" style="background-color:#FFFFFF"></div><div class="legLab">&nbsp Developed-Roads (209.5 ha; 0.53%)</div>
					<div class="color-box" style="background-color:#B86018"></div><div class="legLab">&nbsp Wetland-Herbaceous (164.2 ha; 0.42%)</div>
					<div class="color-box" style="background-color:#CFABD7"></div><div class="legLab">&nbsp Western Cool Temperate Urban Shrubland (158.8 ha; 0.40%)</div>
					<div class="color-box" style="background-color:#FF692E"></div><div class="legLab">&nbsp Introduced Upland Vegetation-Annual Grassland (128.2; 0.33%)</div>
					<div class="color-box" style="background-color:#4EFF3B"></div><div class="legLab">&nbsp Mixed Desert and Thornscrub (126.5 ha; 0.32%)</div>
					<div class="color-box" style="background-color:#F5AF36"></div><div class="legLab">&nbsp Gambel Oak-Mixed Montane Shrubland (124.9 ha; 0.32%)</div>
					<div class="color-box" style="background-color:#51B48D"></div><div class="legLab">&nbsp Warm Desert Riparian Forest and Woodland (99.3 ha; 0.25%)</div>
					<div class="color-box" style="background-color:#646464"></div><div class="legLab">&nbsp Warm Desert Sparsely Vegetated Systems II (99.0 ha; 0.25%)</div>
					<div class="color-box" style="background-color:#FFED77"></div><div class="legLab">&nbsp Western Cool Temperate Close Grown Crop (93.7 ha; 0.24%)</div>
					<div class="color-box" style="background-color:#FF7A8F"></div><div class="legLab">&nbsp Developed-Low Intensity (85.7 ha; 0.22%)</div>
					<div class="color-box" style="background-color:#7A8EF5"></div><div class="legLab">&nbsp Western Cool Temperate Developed Ruderal Grassland (61.5 ha; 0.16%)</div>
					<div class="color-box" style="background-color:#D6FFB5"></div><div class="legLab">&nbsp Ponderosa Pine Woodland (52.1 ha; 0.13%)</div>
					<div class="color-box" style="background-color:#FD2C4F"></div><div class="legLab">&nbsp Developed-Medium Intensity (49.0 ha; 0.12%)</div>
					<div class="color-box" style="background-color:#FFC87D"></div><div class="legLab">&nbsp Semi-Desert Grassland (35.4 ha; 0.09%)</div>
					<div class="color-box" style="background-color:#9C805C"></div><div class="legLab">&nbsp Mixed Salt Desert Scrub (25.0 ha; 0.06%)</div>
					<div class="color-box" style="background-color:#003300"></div><div class="legLab">&nbsp Dry-Mesic Montane Mixed Conifer Forest and Woodland (21.6 ha; 0.05%)</div>
					<div class="color-box" style="background-color:#6677CD"></div><div class="legLab">&nbsp Western Cool Temperate Developed Ruderal Evergreen Forest (20.1 ha; 0.05%)</div>
					<div class="color-box" style="background-color:#917554"></div><div class="legLab">&nbsp Juniper Savanna (17.5 ha; 0.04%)</div>
					<div class="color-box" style="background-color:#C29ED7"></div><div class="legLab">&nbsp Western Cool Temperate Urban Mixed Forest (9.4 ha; 0.02%)</div>
					<div class="color-box" style="background-color:#704489"></div><div class="legLab">&nbsp Western Cool Temperate Urban Deciduous Forest (8.2 ha; 0.02%)</div>
					<div class="color-box" style="background-color:#AA66CD"></div><div class="legLab">&nbsp Western Cool Temperate Urban Evergreen Forest (6.1 ha; 0.02%)</div>
					<div class="color-box" style="background-color:#AD001C"></div><div class="legLab">&nbsp Developed-High Intensity (4.0 ha; 0.01%)</div>
					<div class="color-box" style="background-color:#403DA8"></div><div class="legLab">&nbsp Western Cool Temperate Developed Ruderal Deciduous Forest (0.7 ha; 0.00%)</div>
					<div class="color-box" style="background-color:#FAFF77"></div><div class="legLab">&nbsp Western Cool Temperate Row Crop (0.4 ha; 0.00%)</div>
				      </div>
				    </div>
				</div>
			    </div>

			    </br>

			</div> <!--Closes 'panel-group'-->
                    </div> <!--Closes tab-pane="legend"-->  

		    <div class="tab-pane" id="download">
			<h3>Download Data Layers:</h3>
			    <p> The data layers displayed on this webmap can be downloaded for use in desktop GIS software here.</p>
			    </br>
			    <!--<h4><strong>Soil layers</strong></h4>
			        <ul>
                    		    <li><a href="./downloads/ph_surface_weighted_average.zip">Soil surface pH, weighted average</a></li>
				    <li><a href="./downloads/bulk_density_1_3_bar.zip">Soil bulk density</a></li>
				    <li><a href="./downloads/organic_matter.zip">Organic matter</a></li>
				    <li><a href="./downloads/soil_taxonomy.zip">Soil taxonomic classification</a></li>
				    <li><a href="./downloads/surface_texture_dcp.zip">Surface soil texture</a></li>
				    <li><a href="./downloads/composting_medium_and_final_cover.zip">Compost</a></li>
				</ul>
			    <h4><strong>Vegetation layers</strong></h4>
			        <ul>
                    		    <li><a href="./downloads/landfire-evt-tamaya.tif">Existing vegetation type, LANDFIRE</a></li>
				</ul>-->
			    </br>
			    </br>
                                          
                     </div> <!--Closes tab-pane="download"-->

                </div> <!--Closes 'tab-content'-->
            </div> <!--Closes ID="sidebar"-->

        <div class="col-sm-9 col-lg-9" id="map">
           <!-- <div id="loading" style="display: block;">
                    <div class="loading-indicator">
                        <div class="progress progress-striped active">
                            <div class="progress-bar progress-bar-info" style="width: 100%"></div>
                        </div>
                    </div>
                </div>-->
        </div>

        </div> <!--Closes ID="container"-->

{% endblock side_bar %}

{% block layers %}

<script type="text/javascript">

////////////////////////////
////// Overlay Layers //////
////////////////////////////

    var boundary = new L.GeoJSON.AJAX("{% url 'boundary' %}", {
        style: { clickable: false,
                 weight: 3,
                 color: '#000000',
                 dashArray: 3,
                 opacity: 1,
                 fill: false,
               }
    });

    var mbls = new L.GeoJSON.AJAX("{% url 'mbls' %}", {
        style: function (feature) {
                    if (feature.properties.comment === "Hyatt Tamaya") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#4FE11E',
                            opacity: 0.5,
                            fill: true,
                            fillOpacity: 0.2,
                        };
                    };
                    if (feature.properties.comment === "Prairie Star") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#e8f73e',
                            opacity: 1,
                            fill: true,
                            fillOpacity: 0.2,
                        };
                    };
                    if (feature.properties.comment === "Santa Ana Golf / Star Casino") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#A73BC8',
                            opacity: 1,
                            fill: true,
                            fillOpacity: 0.2,
                        };
                    };
		    if (feature.properties.comment === "Southern Sandoval Investments") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#FF7F00',
                            opacity: 1,
                            fill: true,
                            fillOpacity: 0.2,
                        };
                    };
		    if (feature.properties.comment === "Twin Warriors") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#DB5373',
                            opacity: 1,
                            fill: true,
                            fillOpacity: 0.2,
                        };
                    };
                },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Name:&nbsp;</strong>" + feature.properties.comment.toString() + "</br>" +
                "<strong>Area:&nbsp;</strong>" + feature.properties.area.toString() + "</br>" +
                "<strong>Perimeter:&nbsp;</strong>" + feature.properties.perimeter.toString()
            );
        }
    });

    var roads = new L.GeoJSON.AJAX("{% url 'roads' %}", {
        style: {color: '#797976',
                weight: 2,
                dashArray: 1,
                opacity: 1,
                clickable: true,
               },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Name:&nbsp;</strong>" + feature.properties.name.toString() + "</br>" +
                "<strong>Surface type:&nbsp;</strong>" + feature.properties.surface.toString() + "</br>" +
                "<strong>Condition:&nbsp;</strong>" + feature.properties.condition.toString()
            );
        },
    });

/*
    var bulkDens = new L.GeoJSON.AJAX("{% url 'bulk_density' %}", {
        style: { clickable: true,
                 weight: 1.5,
                 dashArray: 1,
                 opacity: 0.6,
                 fill: false,
               }
    });

    var soil_ph = new L.GeoJSON.AJAX("{% url 'soil_ph' %}", {
        style: {clickable: true,
                 weight: 1.5,
                 dashArray: 1,
                 opacity: 0.6,
                 fill: false,
               }
    });

    var soil_vector1 = new L.GeoJSON.AJAX("{% url 'soil_ph' %}");

    var soil_vector2 = $.getJSON("{% url 'soil_ph' %}");

    var soil_vector = {% autoescape off %}{{ ph_json }}{% endautoescape %};
*/

////////////////////////////
////// Leaflet Map /////////
////////////////////////////

    var map = L.map("map", {
        zoom: 11,
        center: [35.435, -106.54], 
        minZoom: 6,
        maxZoom: 20,
        layers: [recent, boundary, mbls]
    });

///////////////////////////////////////
////// Add Leaflet-Draw controls //////
///////////////////////////////////////

    // Initialize the FeatureGroup to store editable layers

    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    // Specify some custom options for the Drawing tools

	var drawOptions = {
	draw: {
		polygon: {
			showArea: true
			}
	},
	edit: {
		featureGroup: drawnItems
		}
	}

	// Initialize the draw control and pass it the FeatureGroup of editable layers
	var drawControl = new L.Control.Draw(drawOptions);
	
	map.addControl(drawControl);

	map.on('draw:created', function (e) {
	var type = e.layerType,
		layer = e.layer;

	if (type === 'marker') {
		layer.bindPopup('A popup!');
	}

	// Do whatever else you need to. (save to db, add to map etc)
	drawnItems.addLayer(layer);
	});

    // Add opacity controls

    var opacitySlider = new L.Control.opacitySlider();
    map.addControl(opacitySlider);

    //opacitySlider.setOpacityLayer(landfire)

</script>


{% endblock layers %}

