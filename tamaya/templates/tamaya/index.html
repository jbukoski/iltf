{% extends 'base.html' %}
{% load static %}

{% block side_bar %}

    <title>{{ title }}</title>

    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle btn" data-toggle="collapse" data-target=".navbar-collapse" style="height: 34px; padding: 5px 10px; margin-right: 10px;"><i class="fa fa-ellipsis-v" style="color: white"></i></button>
            <button id="toggle" type="button" class="navbar-toggle btn" style="height: 34px; padding: 5px 10px; margin-right: 10px;"><i id="toggleIcon" class="fa fa-check-square-o" style="color: white"></i></button>
            <a class="navbar-brand" href="http://www.tamaya-nsn.gov/index.html" target="_blank_">Pueblo of Santa Ana</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar-collapse">
            <ul class="nav navbar-nav pull-left">
                <a class="navbar-brand" href="#" style="font-size: 0.75m; color: gray;">Land & Natural Assets Map</a>
            </ul>
            <!--<ul class="nav navbar-nav pull-right">
                <a class="navbar-brand" href="/tamaya/admin/logout/" style="font-size: 18px; color: grey;">Log Out</a>
            </ul>-->
        </div>
    </div>

    <div class="row" id="container">
        <div class="col-sm-3 col-lg-3" id="sidebar" style="padding: 10px; overflow: auto;">
            <ul class="nav nav-tabs" id="myTab">
                <li class="active"><a href="#layers" data-toggle="tab"><i class="fa fa-check-square-o"></i>&nbsp;Layers</a></li>
                <li><a href="#upload" data-toggle="tab"><i class="fa fa-upload"></i>&nbsp;Import</a></li>
                <li><a href="#documentation" data-toggle="tab"><i class="fa fa-info-circle"></i>&nbsp;Documentation</a></li>
            </ul>

            <div class="tab-content" style="padding-top: 10px;">
                <div class="tab-pane active" id="layers">
                    <div class="panel-group">

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#admin-layers">
                                    Administrative Layers
                                </a>
                            </div>
                            <div id="admin-layers" class="panel-collapse collapse in">
                                <div class="panel-body" style="padding: 0px 15px;">
				    <div class="checkbox">
				        <label>
                                            <input type="checkbox" name="overlayLayers" id="boundary" z-index="1" checked>
                                            &nbsp Reservation boundary &nbsp <a href="{% url 'boundary_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                        </label>
                                    </div>
				    <div class="checkbox">
				        <label>
                                            <input type="checkbox" name="overlayLayers" id="mbls" z-index="2" checked>
                                            &nbsp Master business leases &nbsp <a href="{% url 'mbl_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                        </label>
                                    </div>
				    <div class="checkbox">
				        <label>
                                            <input type="checkbox" name="overlayLayers" id="roads" z-index="3">
                                            &nbsp Reservation roads &nbsp <a href="{% url 'roads_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                        </label>
                                    </div>
				</div>
	                    </div>
                        </div> <!--Closes 'panel panel-default for administrative layers'-->

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#hydro-layers">
                                        Hydrology Layers
                                </a>
                            </div>
                            <div id="hydro-layers" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="watersheds" z-index="3">
                                            &nbsp Watersheds &nbsp <a href="{% url 'watersheds_dl' %}"><i style="float:right;" class="fa fa-download"></i></a>
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="subwatersheds" z-index="3">
                                            &nbsp Sub-watersheds &nbsp <a href="{% url 'subwatersheds_dl' %}"><i style="float:right;" class="fa fa-download"></i></a>
                                        </label>
                                    </div>
                                     <div class="checkbox">
                                        <label>
                                            <input type="checkbox" name="overlayLayers" id="surfacehydro" z-index="3">
                                            &nbsp Surface hydrology &nbsp <a href="{% url 'surfacehydrology_dl' %}"><i style="float:right;" class="fa fa-download"></i></a>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div> <!--Closes 'panel panel-default for hydrology layers'-->

			    <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#soil-layers">
                                        Soil Characteristics Layers
                                    </a>
                                </div>
                                <div id="soil-layers" class="panel-collapse collapse">
                                    <div class="panel-body" style="padding: 0px 15px;">
					<div class="checkbox">
				            <label>
                                                <input type="checkbox" name="overlayLayers" id="bulkDens" z-index="3">
                                                &nbsp Bulk density &nbsp <a href="{% url 'bulk_dens_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="composting" z-index="3">
                                                &nbsp Composting cover &nbsp <a href="{% url 'compost_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="org_matter" z-index="3">
                                                &nbsp Organic matter &nbsp <a href="{% url 'om_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="soil_ph" z-index="3">
                                                &nbsp Surface pH, weighted average &nbsp <a href="{% url 'ph_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="taxonomy" z-index="3">
                                                &nbsp Taxonomic classification &nbsp <a href="{% url 'tax_cl_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="texture" z-index="3">
                                                &nbsp Texture &nbsp <a href="{% url 'texture_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                        </div>
            		            </div>
            		        </div>
                            </div>

                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#vegetation-layers">
                                        Vegetation Layers
                                    </a>
                                </div>
                                <div id="vegetation-layers" class="panel-collapse collapse">
                                    <div class="panel-body" style="padding: 0px 15px;">
                                       <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="landfireEVT" z-index="3">
                                                &nbsp LANDFIRE Vegetation Type &nbsp <a href="{% url 'landfire_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                       </div>
                                       <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="ndvi2005" z-index="3">
                                                &nbsp Mean Annual NDVI - 2005 &nbsp <a href="{% url 'ndvi_2005_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                       </div>
                                       <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="ndvi2010" z-index="3">
                                                &nbsp Mean Annual NDVI - 2010 &nbsp <a href="{% url 'ndvi_2010_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                       </div>
                                       <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="ndvi2015" z-index="3">
                                                &nbsp Mean Annual NDVI - 2015 &nbsp <a href="{% url 'ndvi_2015_dl' %}"><i style="float:right;" class = "fa fa-download"></i></a>
                                            </label>
                                       </div>
                                    </div>
                                </div>
                            </div>

			    <div class="panel panel-default">
                                <div class="panel-heading">
                                    <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#carbon-layers">
                                        Carbon Layers
                                    </a>
                                </div>
                                <div id="carbon-layers" class="panel-collapse collapse">
                                    <div class="panel-body" style="padding: 0px 15px;">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="agc" z-index="3">
                                                &nbsp Forest aboveground carbon &nbsp <a href="{% url 'agc_dl' %}"><i style="float:right;" class="fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" name="overlayLayers" id="bgc" z-index="3">
                                                &nbsp Forest belowground carbon &nbsp <a href="{% url 'bgc_dl' %}"><i style="float:right;" class="fa fa-download"></i></a>
                                            </label>
                                        </div>
                                        <div class="checkbox">
					    <label>
                                                <input type="checkbox" name="overlayLayers" id="gssurgoSOC" z-index="3">
                                                &nbsp Soil organic carbon &nbsp <a href="{% url 'soc_dl' %}"><i style="float:right;" class="fa fa-download"></i></a>
                                            </label>
                                        </div>
            		            </div>
            		        </div>
                            </div>


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#user-layers">
                                        User-defined Layers
                                </a>
                            </div>
                            <div id="user-layers" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <!-- List of uploaded documents -->
                                    {% if documents %}
                                        {% for document in documents %}
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" name="uploadLayers" id="{{ document.docfile.name }}" z-index="3" onclick="show_static('{{ document.docfile.name }}')"><p class="setFileName2">
                                                        &nbsp {{ document.docfile.name }}</p>
                                                </label>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <p style="padding: 15px 0px 0px 0px;"><i>No documents uploaded.</i></p>
                                    {% endif %}
                                </div>
                            </div>
        	        </div> <!--Closes 'panel panel-default'-->

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#imagery">
                                        Base Layers
                                </a>
                            </div>
                            <div id="imagery" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                		    <div class="radio">
                		        <label>
                                            <input type="radio" name="basemapLayers" id="esriWorld" checked>
                                                &nbsp World Imagery, ESRI
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="basemapLayers" id="topo">
                                                &nbsp Topography, ESRI
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="basemapLayers" id="osmBaseMap">
                                                &nbsp Open Street Map
                                        </label>
                                    </div>
            		        </div>
        	            </div>
                        </div> <!-- closes 'Base Layers' panel -->

            	        <br>
                    </div>  <!--Closes 'panel group'-->
                </div> <!--Closes 'user-defined layers' panel-->

                <div class="tab-pane" id="upload">
                    <div class="row">
                        <div class="col-md-12">
                            <h4><b>Upload Data Layers:</b></h4>
                            </br>
                            <p> New data layers in GeoJSON format (<b>.geojson</b>) and in a <b>EPSG:4326</b> projection may be uploaded to this webmap and used along with existing data for interactivity and visualizations.</p>
                            <div style="height: 20px;"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h4>Upload local <i>.geojson</i> file:</h4>
                            <form role="form" method="POST" action="{% url 'sample_up' %}" enctype="multipart/form-data">
                                {% csrf_token %}
                                <input type="file" name="docfile" onchange="uploader()" id="upload_file">
                                <div style="height: 15px;"></div>
                                <div id="show_upload" style="padding-bottom: 15px;"></div>
                                <button id="send_upload" class="btn btn-danger" style="display: none" type="submit">Upload File</button>
                            </form>
                            <div style="height: 20px;"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h4>Delete Uploaded GeoJSON:</h4>
                            <p>Delete <strong>all</strong> previously uploaded GeoJSON files from the server. <i>Please note that this action cannot be undone.</i></p>
                            <form role="form" method="POST" action="{% url 'delete_up' %}" enctype="multipart/form-data">
                                {% csrf_token %}
                                <input name="del_files" type="file" id="del_files" value="{{ request.path }}" style="display: none;">
                                <button id="del_uploads" class="btn btn-info" type="submit">Delete Files</button>
                            </form>
                            <div style="height: 50px;"></div>
                        </div>
                    </div>
                </div> <!--Closes tab-pane="upload"-->

                <div class="tab-pane" id="documentation">
                    <div class="panel-group">

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#overview">
                                    Overview
                                </a>
                            </div>
                            <div id="overview" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> This webmap is a collaborative product between the <b>Santa Ana Pueblo of New Mexico</b> and the <b>Spatial Informatics Group Natural Assets Laboratory (SIG-NAL)</b>. </p>
                                        <p> The webmap compiles Santa Ana Pueblo data layers with publically available environmental raster layers and several functions designed to facilitate environmental decision-making within the Pueblo's jurisdiction.</p>
                                        <p> For more information on the various data layers and webmap functions provided, expand the tabs below.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#data-layers-overview">
                                    Data Layers Overview
                                </a>
                            </div>
                            <div id="data-layers-overview" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The data layers hosted on this webmap are a combination of layers provided by the Pueblo and publically accessible environmental data layers. Additional information on the layers metadata and sources are provided in the Data Layers tabs below. </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#data-layers-admin" style="padding: 0px 0px 0px 15px;">
                                    <i>Data Layers: Administrative</i>
                                </a>
                            </div>
                            <div id="data-layers-admin" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The <b>administrative layers</b> hosted on the webmap consist of:
                                              <ul>
                                                 <li> <i>Reservation boundary</i> </li>
                                                 <li> <i>Master business leases</i> </li>
                                                 <li> <i>Reservation roads</i> </li>
                                              </ul>
                                              <p>The administrative layers are provided by the Pueblo. The layers provide the approximate reservation boundary, polygons representing five master business leases within the boundary, and a database of roads. The master business leases and roads layers can be queried for additional information.</p>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#data-layers-hydro" style="padding: 0px 0px 0px 15px;">
                                    <i>Data Layers: Hydrology</i>
                                </a>
                            </div>
                            <div id="data-layers-hydro" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The <b>hydrology layers</b> hosted on the webmap consist of:
                                              <ul>
                                                 <li> <i>Watersheds</i> </li>
                                                 <li> <i>Subwatersheds</i> </li>
                                                 <li> <i>Surface hydrology</i> </li>
                                              </ul>
                                              <p>The hydrology layers are provided by the Pueblo and represent the geographic boundaries of watersheds, subwatersheds, and surface hydrology for the region. The watershed and subwatershed layers can be queried for additional information.</p>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#data-layers-soil" style="padding: 0px 0px 0px 15px;">
                                    <i>Data Layers: Soil Characteristics</i>
                                </a>
                            </div>
                            <div id="data-layers-soil" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The <b>soil characteristics layers</b> hosted on the webmap consist of:
                                              <ul>
                                                 <li> <i>Soil bulk density</i> </li>
                                                 <li> <i>Composting cover</i> </li>
                                                 <li> <i>Organic matter</i> </li>
                                                 <li> <i>Surface pH, weighted average</i> </li>
                                                 <li> <i>Taxonomic classification</i> </li>
                                                 <li> <i>Texture</i> </li>
                                              </ul>
                                              <p>The soil characteristics layers provide key soil characteristics data for managing landscapes. The soil characteristics data are provided for distinct sampling units that as identified by the National Cooperative Soil Survey. The data is provided by the Soil Survey Geographic database (SSURGO). More information on the soil characteristics layers can be found <a href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey/?cid=nrcs142p2_053627">here</a>.</p>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#data-layers-vegetation" style="padding: 0px 0px 0px 15px;">
                                    <i>Data Layers: Vegetation</i>
                                </a>
                            </div>
                            <div id="data-layers-vegetation" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The <b>vegetation layers</b> hosted on the webmap consist of:
                                              <ul>
                                                 <li> <i>LANDFIRE Existing Vegetation Type</i> </li>
                                                 <li> <i>Mean Annual NDVI for three different years</i> </li>
                                              </ul>
                                              <p>The <b>LANDFIRE Existing Vegetation Type</b> is a product of the United States Geological Survey that provides the existing vegetation type on the landscape for 2014. More information on LANDFIRE EVT can be found <a href="https://www.landfire.gov/NationalProductDescriptions21.php">here</a>.</p>
                                              <p>The <b>mean annual Normalized Difference Vegetation Index</b> (NDVI) layers provide the mean annual NDVI for 2005, 2010, and 2015 (i.e., the average NDVI value for each pixel in the landscape for the year of interest). NDVI is an indicator of "greenness" in a landscape, and provides a proxy for presence of healthy, green vegetation. More information on NDVI can be found <a href="https://en.wikipedia.org/wiki/Normalized_Difference_Vegetation_Index" target="_blank">here</a>.</p>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#data-layers-carbon" style="padding: 0px 0px 0px 15px;">
                                    <i>Data Layers: Carbon</i>
                                </a>
                            </div>
                            <div id="data-layers-carbon" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The <b>carbon layers</b> hosted on the webmap consist of:
                                              <ul>
                                                 <li> <i>Aboveground forest carbon</i> </li>
                                                 <li> <i>Belowground forest carbon</i> </li>
                                                 <li> <i>Soil organic carbon</i> </li>
                                              </ul>
                                              <p>All of the carbon layers are taken from the United States Department of Agriculture's <a href="www.carbonscapes.org" target="_blank">CarbonScapes</a> Initiative, which seeks to providely publically accessible data on geospatial patterns of terrestrial carbon within the United States.</p>
				              <p>The <b>aboveground forest carbon</b> data layer provides estimates of aboveground biomass carbon (g/cm<sup>3</sup>) gridded at a 250 x 250 m resolution. The data is provided by the USDA Forest Service's Forest Inventory and Analysis, and additional details can be found <a href="http://www.carbonscapes.org/USDA/MapLayerInfo/MapLayerInfo.aspx?id=93">here</a>.</p>
                                              <p>The <b>belowground forest carbon</b> data layer provides estimates of belowground biomass carbon (g/cm<sup>3</sup> gridded at a 250 x 250 m resolution. The data is provided by the USDA Forest Service's Forest Inventory and Analysis, and additional details can be found <a href="http://www.carbonscapes.org/USDA/MapLayerInfo/MapLayerInfo.aspx?id=94">here</a>.</p>
                                              <p>The <b>soil organic carbon</b> provides data on organic carbon (g/cm<sup>3</sup>) from 0 - 100 cm, gridded to a 10 x 10 m resolution. The data is provided by the gridded Soil Survey Geographic Database (gSSURGO), and additional details can be found <a href="http://www.carbonscapes.org/USDA/MapLayerInfo/MapLayerInfo.aspx?id=80">here</a>.</p>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#functions-overview">
                                    Functions Overview
                                </a>
                            </div>
                            <div id="functions-overview" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> The data layers hosted on this webmap are a combination of layers provided by the Pueblo and publically accessible environmental data layers.</p>
                                        <p> The <i> Admin Layers </i> and the <i> Hydrology Layers </i> were provided by the Pueblo. </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#import-doc" style="padding: 0px 0px 0px 15px;">
                                    <i>Functions: Layer Import</i>
                                </a>
                            </div>
                            <div id="import-doc" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> Some text </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#legend" style="padding: 0px 0px 0px 15px;">
                                    <i>Functions: Legend</i>
                                </a>
                            </div>
                            <div id="legend" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> Some text </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <a class="accordion-toggle btn-block" data-toggle="collapse" data-parent="#accordion_" href="#sum-stats" style="padding: 0px 0px 0px 15px;">
                                    <i>Functions: Summary Statistics</i>
                                </a>
                            </div>
                            <div id="sum-stats" class="panel-collapse collapse">
                                <div class="panel-body" style="padding: 0px 15px;">
                                    <div style="padding: 15px 5px;">
                                        <p> Some text </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- closes 'panel-group' -->
                </div> <!--Closes tab-pane="documentation"-->

            </div> <!--Closes 'tab-content'-->
        </div> <!--Closes ID="sidebar"-->

        <div class="col-sm-9 col-lg-9" id="map"></div>

        </div> <!--Closes ID="container"-->

{% endblock side_bar %}

{% block layers %}

<script type="text/javascript" href="http://depot.ign.fr/geoportail/api/develop/tech-docs-js/examples/js/geoportalLeaflet.js"></script>
<script type="text/javascript">

////////////////////////////
////// Upload Layers //////
////////////////////////////

var uploaded_layers = $('#downloads_uploads').children();
var num_layers = uploaded_layers.length;
var tmp_url = null;

for ( var i = 0; i < num_layers; i++ ) {

    try {
        tmp_url = uploaded_layers[i].children[1].value;
    } catch ( err ) {
        tmp_url = null;
    }

}

function show_static( tmp_idx ) {
    var usr_lyr = new L.GeoJSON();
    var data = {'layer': tmp_idx, csrfmiddlewaretoken: '{{csrf_token }}'};

    $.post('{% url 'render_geojson' %}', data, function(resp) {
        var geojson_lyr = JSON.parse(resp.layer_json);
        usr_lyr.addData(geojson_lyr);
    });

    if ( tmp_idx == 0 ) {
        console.log('tmp_idxi_0: ', tmp_idx);
    } else {
        $("input[type='checkbox'][id='" + tmp_idx + "']").change(function () {
            if (this.checked) {
                map.addLayer(usr_lyr);
            } else if (!this.checked) {
                map.removeLayer(usr_lyr);
                usr_lyr.clearLayers();
            };
        });
    }
}

function uploader() {

    var x = document.getElementById( "upload_file" );
    var txt = " ";
    var file;
    var checkerr = false;

    if ( "files" in x ) {
        if ( x.files.length == 0 ) {
            txt = "<br>Select one or more files.<br>";
        } else {
            txt += "<hr><h5>File Breakdown</h5><br>";
            file = x.files[0];
            checkerr = true;

            if ( "name" in file ) {
                txt += "<strong>File Name: </strong>" + file.name + "<br>";
            }

            if ( "size" in file ) {
                txt += "<strong>File Size: </strong>" + file.size + " bytes <br>";
            }

            if ( "lastModifiedDate" in file ) {
                txt += "<strong>File Last Modified: </strong><br>" + file.lastModifiedDate + "<br>";
            }
        }
    } else {
        if ( x.value == "" ) {
            txt += "Select a GeoJSON or SHP file to upload.";
        } else {
            txt += "<strong>The files property is not supported by your browser!</strong><hr>";
            txt += "<strong>File path: </strong>" + x.value;
        }
    }
    document.getElementById("show_upload").innerHTML = txt;

    if ( checkerr ) {
        document.getElementById("send_upload").style.display = "block";
    } else {
        document.getElementById("send_upload").style.display = "none";
    }
}


////////////////////////////
////// Overlay Layers //////
////////////////////////////

////// Raster Layers ///////

    var agc = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_agc',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF'
    });

    var bgc = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_bgc',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF'
    });

    var gssurgoSOC = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_gssurgo_soc',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF'
    });

    var landfireEVT = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_evt',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF',
        clickable: true
    });

    var ndvi2005 = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_ndvi_2005',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF',
        clickable: true
    });

    var ndvi2010 = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_ndvi_2010',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF',
        clickable: true
    });

    var ndvi2015 = new L.tileLayer.wms('http://198.167.239.16:8081/geoserver/iltf/wms?', {
        service: 'WMS',
        version: '1.1.1',
        request: 'GetMap',
        format: 'image/png',
        layers: 'iltf:tamaya_ndvi_2015',
        transparent: true,
        tiled: true,
        zIndex: 10,
        bgcolor: '#FFFFFF',
        clickable: true
    });



/////// Oliver's Layers ////////

    var sample_boundary=new L.GeoJSON.AJAX("{% url 'render_geojson' %}", {
        style: { clickable: false,
                 weight: 3,
                 //color: '#000000',
                 dashArray: 3,
                 opacity: 1,
                 fill: false,
               }
    });

//////// Vector Layers ////////

    var boundary=new L.GeoJSON.AJAX("{% url 'boundary' %}", {
        style: { clickable: false,
                 weight: 3,
                 color: '#000000',
                 dashArray: 3,
                 opacity: 1,
                 fill: false,
               }
    });

    var mbls=new L.GeoJSON.AJAX("{% url 'mbls' %}", {
        style: function (feature) {
                    if (feature.properties.comment === "Hyatt Tamaya") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#4FE11E',
                            fill: true,
                            fillOpacity: 0.5,
                        };
                    };
                    if (feature.properties.comment === "Prairie Star") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#e8f73e',
                            fill: true,
                            fillOpacity: 0.5,
                        };
                    };
                    if (feature.properties.comment === "Santa Ana Golf / Star Casino") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#A73BC8',
                            fill: true,
                            fillOpacity: 0.5,
                        };
                    };
		    if (feature.properties.comment === "Southern Sandoval Investments") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#FF7F00',
                            fill: true,
                            fillOpacity: 0.5,
                        };
                    };
		    if (feature.properties.comment === "Twin Warriors") {
                        return {
                            clickable: true,
                            weight: 2,
                            color: '#DB5373',
                            fill: true,
                            fillOpacity: 0.5,
                        };
                    };
                },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Name:&nbsp;</strong>" + feature.properties.comment.toString() + "<br>" +
                "<strong>Area:&nbsp;</strong>" + feature.properties.area.toString() + "<br>" +
                "<strong>Perimeter:&nbsp;</strong>" + feature.properties.perimeter.toString()
            );
        }
    });

    var roads=new L.GeoJSON.AJAX("{% url 'roads' %}", {
        style: {color: '#ffffff',
                weight: 2,
                dashArray: 1,
                opacity: 1,
                clickable: true,
               },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Name:&nbsp;</strong>" + feature.properties.name.toString() + "<br>" +
                "<strong>Surface type:&nbsp;</strong>" + feature.properties.surface.toString() + "<br>" +
                "<strong>Condition:&nbsp;</strong>" + feature.properties.condition.toString()
            );
        },
    });

    var watersheds = new L.GeoJSON.AJAX("{% url 'watersheds' %}", {
        style: {color: '#99BADD',
                weight: 2,
                dashArray: 1,
                opacity: 0.5,
                clickable: true,
               },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Watershed:&nbsp;</strong>" + feature.properties.hu_8_name.toString()
            );
        },
    });

    var subwatersheds = new L.GeoJSON.AJAX("{% url 'subwatersheds' %}", {
        style: {color: '#3939b8',
                weight: 2,
                dashArray: 1,
                opacity: 1,
                clickable: false,
               },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<b>Watershed:&nbsp;</b>" + feature.properties.watershed.toString() +
                "</br><b>Subwatershed ID: &nbsp; </b>" + feature.properties.subwatshed.toString()
            );
        },
    });

    var surfacehydro = new L.GeoJSON.AJAX("{% url 'surfacehydro' %}", {
        style: {color: '#000080',
                weight: 2,
                dashArray: 1,
                opacity: 0.7,
               },
    });

    var bulkDens = new L.GeoJSON.AJAX("{% url 'soil_data' %}", {
        style: function(feature) {
		    switch (true) {
                        case (feature.properties.bulk_densi <= 1.3):
                            return {color: "#ffffff", fillColor: "#E3CE9F", fill: true, fillOpacity: 0.8, weight: 0.8};
                        case (feature.properties.bulk_densi > 1.3 && feature.properties.bulk_densi <= 1.4):
                            return {color: "#ffffff", fillColor: "#C5AB71", fill: true, fillOpacity: 0.8, weight: 0.8};
                        case (feature.properties.bulk_densi > 1.4 && feature.properties.bulk_densi <= 1.5):
                            return {color: "#ffffff", fillColor: "#B6995A", fill: true, fillOpacity: 0.8, weight: 0.8};
                        case (feature.properties.bulk_densi > 1.5 && feature.properties.bulk_densi <= 1.6):
                            return {color: "#ffffff", fillColor: "#A07F38", fill: true, fillOpacity: 0.8, weight: 0.8};
                        case (feature.properties.bulk_densi > 1.6):
                            return {color: "#ffffff", fillColor: "#825C0B", fill: true, fillOpacity: 0.8, weight: 0.8};
			}
        },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Feature ID:&nbsp;</strong>" + feature.properties.poly_id +
                "<br><strong>Bulk density:&nbsp;</strong>" + feature.properties.bulk_densi + "&nbsp;g/cm" + "3".sup() +
                "<br><strong>Soil taxonomic class:&nbsp;</strong>" + feature.properties.tax_class, {
                closeButton: false
            });
        },
    });

    var composting=new L.GeoJSON.AJAX("{% url 'soil_data' %}", {
        style: function(feature) {
                    switch (feature.properties.composting) {
                        case 'Poor': return {color: "#ffffff", fillColor: "#BC3812", fill: true, fillOpacity: 0.8, weight: 0.8};
                        case 'Fair': return {color: "#ffffff", fillColor: "#553ADB", fill: true, fillOpacity: 0.8, weight: 0.8};
                        case 'Good': return {color: "#ffffff", fillColor: '#08794E', fill: true, fillOpacity: 0.8, weight: 0.8};
                        case 'Not rated': return {color: "#ffffff", fillColor: '#B2C7EE', fill: true, fillOpacity: 0.8, weight: 0.8};
                        }
        },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Feature ID:&nbsp;</strong>" + feature.properties.poly_id +
                "<br><strong>Composting cover:&nbsp;</strong>" + feature.properties.composting +
                "<br><strong>Soil taxonomic class:&nbsp;</strong>" + feature.properties.tax_class, {
                closeButton: false
            });
        },
    });

    var org_matter=new L.GeoJSON.AJAX("{% url 'soil_data' %}", {
        style: function(feature) {
                   switch (true) {
                       case (feature.properties.org_matter > 1.5):
                           return {color: "#ffffff", fillColor: '#397D02', fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.org_matter > 1.25 && feature.properties.org_matter <= 1.5):
                           return {color: "#ffffff", fillColor: "#567E3A", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.org_matter > 1.00 && feature.properties.org_matter <= 1.25):
                           return {color: "#ffffff", fillColor: "#61B329", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.org_matter > 0.75 && feature.properties.org_matter <= 1.00):
                           return {color: "#ffffff", fillColor: "#A6D785", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.org_matter > 0.5 && feature.properties.org_matter <= 0.75):
                           return {color: "#ffffff", fillColor: "#8AA37B", fill: true, fillOpacity: 0.8, weight: 0.8};
                       default:
                           return {color: "#ffffff", fillColor: "#687E5A", fill: true, fillOpacity: 0.8, weight: 0.8};
                   }
        },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Feature ID:&nbsp;</strong>" + feature.properties.poly_id +
                "<br><strong>Organic matter:&nbsp;</strong>" + feature.properties.org_matter + "%" +
                "<br><strong>Soil taxonomic class:&nbsp;</strong>" + feature.properties.tax_class, {
                closeButton: false
            });
        },
    });

    var soil_ph=new L.GeoJSON.AJAX("{% url 'soil_data' %}", {
        style: function(feature) {
		    switch (feature.properties.ph_water) {
			case 7: return {color: "#ffffff", fillColor: "#d7191c", fillOpacity: 0.8, weight: 0.8};
			case 7.1: return {color: "#ffffff", fillColor: "#e65437", fillOpacity: 0.8, weight: 0.8};
			case 7.3: return {color: "#ffffff", fillColor: '#f59053', fillOpacity: 0.8, weight: 0.8};
			case 7.5: return {color: "#ffffff", fillColor: '#fdbe73', fillOpacity: 0.8, weight: 0.8};
			case 7.6: return {color: "#ffffff", fillColor: '#fede99', fillOpacity: 0.8, weight: 0.8};
			case 7.7: return {color: "#ffffff", fillColor: '#ffffbf', fillOpacity: 0.8, weight: 0.8};
			case 7.8: return {color: "#ffffff", fillColor: '#ddf1bf', fillOpacity: 0.8, weight: 0.8};
			case 7.9: return {color: "#ffffff", fillColor: '#bbe3a9', fillOpacity: 0.8, weight: 0.8};
			case 8.0: return {color: "#ffffff", fillColor: '#91cba8', fillOpacity: 0.8, weight: 0.8};
			case 8.1: return {color: "#ffffff", fillColor: '#5ea781', fillOpacity: 0.8, weight: 0.8};
                    }
        },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Feature ID:&nbsp;</strong>" + feature.properties.poly_id +
                "<br><strong>Soil pH:&nbsp;</strong>" + feature.properties.ph_water +
                "<br><strong>Soil taxonomic class:&nbsp;</strong>" + feature.properties.tax_class, {
                closeButton: false
            });
        },
    });

    var taxonomy=new L.GeoJSON.AJAX("{% url 'soil_data' %}", {
        style: function(feature) {
                   switch (true) {
                       case (feature.properties.tax_class.includes("Calciorthids")):
                           return {color: "#ffffff", fillColor: "#d12ea1", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Haplargids")):
                           return {color: "#ffffff", fillColor: "#3a2466", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Haplustalfs")):
                           return {color: "#ffffff", fillColor: "#1c1ed1", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Torrifluvents")):
                           return {color: "#ffffff", fillColor: "#a17153", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Torriorthents")):
                           return {color: "#ffffff", fillColor: "#f17369", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Torripsamments")):
                           return {color: "#ffffff", fillColor: "#55360c", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Ustifluvents")):
                           return {color: "#ffffff", fillColor: "#7f4a21", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Ustipsamments")):
                           return {color: "#ffffff", fillColor: "#58f171", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.tax_class.includes("Ustorthents")):
                           return {color: "#ffffff", fillColor: "#7c607c", fill: true, fillOpacity: 0.8, weight: 0.8};
                       default:
                           return {color: "#ffffff", fillColor: "#ffffff", fill: true, fillOpacity: 0.8, weight: 0.8};
                   }
               },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Feature ID:&nbsp;</strong>" + feature.properties.poly_id +
                "<br><strong>Taxonomic class:&nbsp;</strong>" + feature.properties.tax_class, {
                closeButton: false
            });
        },
    });

    var texture=new L.GeoJSON.AJAX("{% url 'soil_data' %}", {
        style: function(feature) {
                    switch (true) {
                       case (feature.properties.texture.toLowerCase().includes("clay loam")):
                           return {color: "#ffffff", fillColor: "#CCCC00", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("cobbly loam")):
                           return {color: "#ffffff", fillColor: "#999900", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("fine sand")):
                           return {color: "#ffffff", fillColor: "#ffd700", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("loam")):
                           return {color: "#ffffff", fillColor: "#FFFF00", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("loamy sand")):
                           return {color: "#ffffff", fillColor: "#ffa500", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("sand")):
                           return {color: "#ffffff", fillColor: "#ff8c00", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("sandy loam")):
                           return {color: "#ffffff", fillColor: "#FFFF66", fill: true, fillOpacity: 0.8, weight: 0.8};
                       case (feature.properties.texture.toLowerCase().includes("stony loam")):
                           return {color: "#ffffff", fillColor: "#666600", fill: true, fillOpacity: 0.8, weight: 0.8};

                       default:
                           return {color: "#ffffff", fillColor: "#ffffff", fill: true, fillOpacity: 0.8, weight: 0.8};
                    }
        },
        onEachFeature: function(feature, layer) {
            layer.bindPopup(
                "<strong>Feature ID:&nbsp;</strong>" + feature.properties.poly_id +
                "<br><strong>Soil texture:&nbsp;</strong>" + feature.properties.texture +
                "<br><strong>Soil taxonomic class:&nbsp;</strong>" + feature.properties.tax_class, {
                closeButton: false
            });
        },
    });


////////////////////////////
////// Leaflet Map /////////
////////////////////////////

    var map = L.map("map", {
        zoom: 11,
        center: [35.435, -106.58],
        minZoom: 6,
        maxZoom: 20,
        layers: [esriWorld, boundary, mbls]
    });

////////////////////////////////////
//// Build legend functionality ////
////////////////////////////////////


    $("div#vegetation-layers input[type='checkbox']").change(function () {
        if ($("div#vegetation-layers input[type='checkbox']").is(':checked')) {

            var popup = L.popup();

            map.on('click', function(e) {
                var lng = e.latlng.lng;
                var lat = e.latlng.lat;
                var carbonLyrLength = document.querySelectorAll("div#carbon-layers input[type='checkbox']:checked").length;
                var veg_lyrs = $("div#vegetation-layers input[type='checkbox']:checked").map(function() {return this.id;});
                var veg_arr = $.map(veg_lyrs, function(value, index) { return [value]; });
                
                if(carbonLyrLength === 0) { updateLatLng(lat, lng, veg_arr); };
            });

            function updateLatLng(lat, lng, veg_arr) {
                var data = {'lat': lat, 'lng': lng, csrfmiddlewaretoken: '{{ csrf_token }}'};

                $.post('{% url 'legend' %}', data, function(resp) {
                    var text = resp.legText
                    var arr = [];
                    for(var key in veg_arr) { arr.push(text[veg_arr[key]]); };
                    var arr_string = arr.join('');

                    popup
                        .setLatLng([lat, lng])
                        .setContent("<p><b>VEGETATION LAYERS LEGENDS: </b></br></br>" + arr_string + "</p>")
                        .openOn(map);
                });
            };
        } else {
            map.closePopup();
            map.off('click');
        };
    });

/////////////////////////////////////////////////////////
//// Add north arrow, scale, and easy print function ////
/////////////////////////////////////////////////////////

    L.control.scale().addTo(map);
    L.easyPrint().addTo(map);

    var north = L.control({position: "bottomright"});
    north.onAdd = function(map) {
        var div = L.DomUtil.create("div", "info legend");
        div.innerHTML = '<img src="{% static '/img/north_arrow.png' %}" height="40" width="40">';
        return div;
    }
    north.addTo(map);

///////////////////////////////////////
////// Add Leaflet-Draw controls //////
///////////////////////////////////////

    // Initialize the FeatureGroup to store editable layers

    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    // Specify some custom options for the Drawing tools

    var drawOptionsFull = {
          draw: {
            polygon: {showArea: true},
            circle: false,
            marker: false,
            polyline: false
	  },
	  edit: {
            featureGroup: drawnItems
	  }
	}

    var drawOptionsEditOnly = {
          edit: {
            featureGroup: drawnItems
          },
          draw: false
    };

    // Initialize the draw control and pass it the FeatureGroup of editable layers
    var drawControlFull = new L.Control.Draw(drawOptionsFull);
    var drawControlEditOnly = new L.Control.Draw(drawOptionsEditOnly);
    var layerGeom = {};

    map.addControl(drawControlFull);

    map.on('draw:created', function (e) {
        var layer = e.layer;
        drawnItems.addLayer(layer);
        drawControlFull.remove(map);
        drawControlEditOnly.addTo(map);

    });

    map.on('draw:deleted', function(e) {
        if (drawnItems.getLayers().length === 0) {
            drawControlEditOnly.remove(map);
            drawControlFull.addTo(map);
        };
    });


    drawnItems.on("click", function(e) {
        var layer = e.layer;
        var type = layer.toGeoJSON().geometry.type;

	if (type === 'Polygon') {
            var centroid = layer.getBounds().getCenter();
            var layerGeoJSON = layer.toGeoJSON();
            var layerGeom = JSON.stringify(layerGeoJSON.geometry);
            var queryPopup = L.popup(); 
            var c_lyrs = $("div#carbon-layers input[type='checkbox']:checked").map(function() {return this.id;});
            var c_arr = $.map(c_lyrs, function(value, index) { return [value]; });

            data = {'geom': layerGeom, csrfmiddlewaretoken: '{{ csrf_token }}'};

            $.post('{% url 'sumstats' %}', data, function(resp) {
                    var sumstats = resp.text
                    var arr = [];
                    for(var key in c_arr) { arr.push(sumstats[c_arr[key]]); };
                    var arr_string = arr.join('');

                    queryPopup
                        .setLatLng(centroid)
                        .setContent('<p><b>SUMMARY STATISTICS: </b>' +
                                    '</br><b>&nbsp&nbspArea selected: </b>' + resp.totalArea + ' ha' +
                                    '</br><b>&nbsp&nbspForest area selected: </b>' + '~' + resp.forestArea + ' ha</br>' +
                                    arr_string + "</p>")
                        .openOn(map);
            });
        };
    });


///////////////////////
//// Oliver's code ////
///////////////////////

    // Check out file names

    $(window).bind("load", function() {

        var all_files = $(".setFileName");
        var num_files = all_files.length;
        var start_char = 16;
        var filee, num_char;

        var all_files2 = $(".setFileName2");
        var num_files2 = all_files2.length;
        var start_char2 = 22;
        var filee2, num_char2;

        for ( var i = 0; i < num_files; i++ ) {

            var num_char = all_files[i].innerText.length;
            var new_txt = all_files[i].innerText.slice(start_char, num_char);
            $(".setFileName")[i].innerText = new_txt;
        }

        for ( var j = 0; j < num_files2; j++ ) {

            var num_char2 = all_files2[j].innerText.length;
            start_char2 = all_files2[0].innerText.search("uploaded") + 9;
            var new_txt2 = all_files2[j].innerText.slice(start_char2, num_char2);
            $(".setFileName2")[j].innerText = new_txt2;
        }

    });

    // class="setFileName"

</script>

{% endblock layers %}
